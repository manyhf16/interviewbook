---
search:
    keywords: ['悲观锁', '乐观锁']

---


# 乐观锁和悲观锁的理解

# 参考解答

首先看一个著名的 **丢失更新** 问题：
两个用户同时修改一条数据，原数据为：
```
id        name        age
1         张三         18
```

程序设计时采用下列sql来完成更新
```sql
update stu set name=?, age=? where id=?
```

|时间|执行用户|sql|解析|
|-|-|-|-|
|t1|用户1|select * from stu where id=1|用户1看到的数据为1,张三,18并显示在表单页面，准备更新age 18->20 |
|t2|用户2|select * from stu where id=1|用户2看到的数据为1,张三,18并显示在表单页面，准备更新name 张三->张小三|
|t3|用户2|update stu set name=张小三, age=18 where id=1|以自己看到的数据，执行更新|
|t4|用户2|commit|事务提交|
|t5|用户1|update stu set name=张三, age=20 where id=1|以自己看到的数据，执行更新|
|t6|用户1|commit|事务提交|
|t7|用户2|select * from stu where id=1|用户2看到的数据是1,张三,20，用户2对姓名的修改丢失了|

