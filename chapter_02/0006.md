---
search:
    keywords: ['悲观锁', '乐观锁']

---


# 乐观锁和悲观锁的理解

# 参考解答

首先看一个著名的 **丢失更新** 问题：
两个用户同时修改一条数据，原数据为一个商品数据，库存还有1件：
```
id        name        stock
1         iphone      1
```

|时间|执行用户|sql|解析|
|-|-|-|-|
|t1|用户1|select * from product where id=1|用户1看到的库存为1件|
|t2|用户2|select * from product where id=1|用户1看到的库存为1件|
|t3|用户2|update product set stock=stock-1 where id=1|以自己看到的数据，执行更新，希望买走这件商品|
|t4|用户2|commit|成功购入|
|t5|用户1|update product set stock=stock-1 where id=1||
